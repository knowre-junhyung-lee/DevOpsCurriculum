# Quest 03. 네트워크의 기초

## Introduction
* 이번 퀘스트에서는 인터넷이 어떻게 동작하며, 서버와 클라이언트, 웹 브라우저 등의 역할은 무엇인지 알아보겠습니다.

## Topics
* 서버와 클라이언트, 그리고 웹 브라우저
* 인터넷을 구성하는 여러 가지 프로토콜
  * IP
  * TCP
  * HTTP
* DNS

## Resources
* [OSI 모형](https://ko.wikipedia.org/wiki/OSI_%EB%AA%A8%ED%98%95)
* [인터넷 프로토콜](https://ko.wikipedia.org/wiki/%EC%9D%B8%ED%84%B0%EB%84%B7_%ED%94%84%EB%A1%9C%ED%86%A0%EC%BD%9C)
* [traceroute](https://ping.eu/traceroute/)
* [TCP](https://ko.wikipedia.org/wiki/%EC%A0%84%EC%86%A1_%EC%A0%9C%EC%96%B4_%ED%94%84%EB%A1%9C%ED%86%A0%EC%BD%9C)
* [Wireshark](https://www.wireshark.org/download.html)
* [HTTP](https://ko.wikipedia.org/wiki/HTTP)
* [DNS](https://ko.wikipedia.org/wiki/%EB%8F%84%EB%A9%94%EC%9D%B8_%EB%84%A4%EC%9E%84_%EC%8B%9C%EC%8A%A4%ED%85%9C)
* [Web-Based Dig](https://networking.ringofsaturn.com/Tools/dig.php)

## Checklist
* 인터넷은 어떻게 동작하나요? OSI 7 Layer에 입각하여 설명해 보세요.
  * 인터넷은 여러가지 프로토콜의 조합과 인프라의 결합이라고 생각합니다.
OSI 7 Layer 는 응용, 표현, 세션, 전송, 네트워크, 데이터 링크, 물리 계층으로 이루어져 있습니다.
그 중 응용, 표현, 세션 계층은 어플리케이션의 기능, 표현 방식, 통신을 성립시키는 역할을 합니다.
프로토콜로는 HTTP,DNS, DHCP 등 이 있습니다.
다음 전송 계층은 개별 프로세스 간의 통신을 위한 계층입니다. 포트를 이용하여 프로세스를 구분하고
세그먼트라는 단위의 정보를 전송합니다. 프로토콜로는 TCP, UDP 등 이 있습니다.
다음 네트워크 계층은 컴퓨터 간의 통신을 위한 계층입니다. IP 주소를 이용하여 논리적인 컴퓨터를 구분하고
패킷이라는 단위의 정보를 전송합니다. 프로토콜로는 IP, OSPF, RIP 등 이 있습니다.
다음 데이터 링크 계층은 직접 연결된 노드 간의 통신을 위한 계층입니다. MAC 주소를 이용하여 유일한 노드를 구분하고
프레임이라는 단위의 정보를 전송합니다. 프로토콜로는 ethernet 이 있습니다.
다음 물리 계층은 물리적인 전송 선로에 전기신호 또는 광 신호 등의 물리적 신호를 전송하는 계층입니다.
비트단위 정보를 전송합니다.
인터넷으로 통신을 할때는 사용자들의 컴퓨터뿐만이 아니라 중간에서 트래픽을 전송해줄 네트워크망이 필요합니다.
사용자 컴퓨터에서 각 계층의 HTTP, TCP, IP ,ethernet 등 다양한 프로토콜을 조합하여 네트워크망으로 정보를 전송합니다.
네트워크망은 수신한 정보에 목적지로 갈 수 있는 경로를 배정함으로써 통신을 가능하게합니다.
* 우리가 브라우저의 주소 창에 `www.knowre.com` 을 쳤을 때, 어떤 과정을 통해 노리의 서버 주소를 알게 되나요?
  * 먼저 브라우저에서 "www.knowre.com" 을 치면 dns 에 대한 질의를 시도하려고 합니다.
이 순간 호스트에 등록된 호스트 파일을 확인하여 "www.knowre.com" 에 해당하는 IP 주소를 찾습니다. IP 주소가 존재한다면
바로 IP 주소를 사용합니다.
만약 존재하지 않는다면 호스트에 설정된 도메인네임서버로 DNS 질의를 시도합니다.
이 순간 도메인 네임서버가 현재 컴퓨터의 네트워크와 같은 네트워크인지 확인합니다.
같은 네트워크에 속한다면 해당 NIC 로 패킷을 생성하여 패킷을 전송합니다.
만약 같은 네트워크에 속하지 않는다면 게이트웨이 주소를 향해 패킷을 전송합니다.
이 순간 게이트웨이의 MAC 주소에 대한 ARP 정보가 없다면 ARP 요청을 보내 게이트웨이의 MAC 주소를 알아냅니다.
MAC 주소를 알고 있다면 게이트웨이로 바로 전송합니다.
게이트웨이 역할을 하는 라우터는 패킷을 수신하면 목적지 네임 서버에 패킷을 전달합니다.
네임서버는 패킷을 수신하고 어떤 도메인을 질의하는 지 확인합니다.
자신의 도메인이 맞다면 해당하는 도메인의 IP 주소 정보를 전송하고 아니라면 최상위 도메인에 질의를 진행합니다.
최상위 도메인 서버 역시 자신의 도메인이 맞다면 해당하는 도메인의 IP 주소 정보를 전송하고 아니라면 하위 도메인의 정보를 전송합니다.
하위 도메인 서버도 도메인을 확인하고 같은 과정을 반복하다가 knowre.com 에 해당하는 네임서버에 도달하면 해당 IP 주소 정보를 받게 됩니다.
웹 브라우저는 이렇게 알아낸 IP 주소를 이용하여 HTTP 접속을 시도하고 메인페이지를 수신하게 됩니다.

## Quest
* tracert(Windows가 아닌 경우 traceroute) 명령을 통해 `www.google.com` 까지 가는 경로를 찾아 보세요.
  * 어떤 IP주소들이 있나요?
    * 192.168.219.1 (192.168.219.1)  

      14.6.253.1 (14.6.253.1) (서울특별시 용산구 한강대로32 LG u+).   

      1.213.10.145 (1.213.10.145)      

      10.204.233.237 (10.204.233.237)    

      1.213.10.145 (1.213.10.145)    

      74.125.118.154 (74.125.118.154)    

      72.14.215.29 (72.14.215.29)    

      74.125.118.154 (74.125.118.154)    

      hkg12s28-in-f4.1e100.net (142.250.66.100) (Google LLC)
 
  * 그 IP주소들은 어디에 위치해 있나요?
    * (서울특별시 용산구 한강대로32 LG u+), (Google LLC)
* Wireshark를 통해 `www.google.com` 으로 요청을 날렸을 떄 어떤 TCP 패킷이 오가는지 확인해 보세요
  * TCP 패킷을 주고받는 과정은 어떻게 되나요?
    * 첫번째로 “www.google.com” 도메인에 대한 질의, 응답 패킷이 udp 53번를 통해 주고 받습니다.
    * 두번째로 TCP three-way handshake 를 통해 TCP 세션을 성립합니다.
    * 세번째로 맺어진 TCP 세션을 통해 TLS 협상을 진행합니다.
    * 네번째로 HTTP 프로토콜을 통해서 “www.google.com” 도메인의 메인 페이지를 가져옵니다.
  * 각각의 패킷의 헤더에 어떤 정보들이 담겨 있나요?
    * DNS 질의 응답 패킷에는 질의하는 레코드의 종류와 도메인, 해당하는 IP에 대한 정보가 담겨있습니다.
    * TCP three-way handshake 패킷에는 syn 플래그를 활성화하여 서버에게 보내고 syn , ack 플레그를 활설화하여 세션을 성립합니다.
    * TLS 협상 과정에서는 서로의 암호화 스팩에 대한 정보를 공유하며 정해진 스팩으로 암호화를 진행합니다.
    * 마지막 HTTP 패킷은 수신되어 웹 브라우저에서 확인이 되지만 TLS 로 암호화되어 확인이 불가합니다.
* telnet 명령을 통해 `http://www.google.com/` URL에 HTTP 요청을 날려 보세요.
  * 어떤 헤더들이 있나요?
  * 그 헤더들은 어떤 역할을 하나요?

## Advanced
* HTTP의 최신 버전인 HTTP/3는 어떤 식으로 구성되어 있을까요?
* TCP/IP 외에 전세계적인 네트워크를 구성하기 위한 다른 방식도 제안된 바 있을까요?
